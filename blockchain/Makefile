# Demiurge Blockchain Node - Makefile
# External build system to avoid Cursor crashes

.PHONY: help check build build-release build-docker clean test run-dev run-testnet

# Default target
help:
	@echo "üî® Demiurge Blockchain Node - Build System"
	@echo ""
	@echo "Available targets:"
	@echo "  make check          - Check compilation (fast, ~5 min)"
	@echo "  make build          - Debug build"
	@echo "  make build-release  - Release build (slow, ~30-60 min)"
	@echo "  make build-docker   - Build Docker image"
	@echo "  make clean          - Clean build artifacts"
	@echo "  make test           - Run tests"
	@echo "  make run-dev        - Run development node"
	@echo "  make run-testnet    - Run testnet node"
	@echo ""
	@echo "‚ö†Ô∏è  Always run builds in external terminal, not Cursor!"

# Check compilation only
check:
	@echo "‚ñ∂ Checking compilation..."
	cargo check --release --workspace

# Debug build
build:
	@echo "‚ñ∂ Building debug binary..."
	cargo build --bin demiurge-node

# Release build
build-release:
	@echo "‚ñ∂ Building release binary..."
	@echo "‚ö†Ô∏è  This will take 30-60 minutes..."
	cargo build --release --bin demiurge-node
	@echo "‚úì Build complete!"
	@echo "Binary: target/release/demiurge-node"

# Docker build
build-docker:
	@echo "‚ñ∂ Building Docker image..."
	docker build -t demiurge-node:latest .
	@echo "‚úì Docker build complete!"

# Clean build artifacts
clean:
	@echo "‚ñ∂ Cleaning build cache..."
	cargo clean
	@echo "‚úì Clean complete!"

# Run tests
test:
	@echo "‚ñ∂ Running tests..."
	cargo test --workspace

# Run development node
run-dev: build-release
	@echo "‚ñ∂ Starting development node..."
	./target/release/demiurge-node --dev --rpc-cors=all --rpc-external

# Run testnet node
run-testnet: build-release
	@echo "‚ñ∂ Starting testnet node..."
	./target/release/demiurge-node \
		--chain=demiurge-testnet \
		--name="Pleroma-Validator" \
		--validator \
		--rpc-cors=all \
		--rpc-external \
		--prometheus-external
